<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yudi & Yoga - Audit Sistem Informasi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #2d3748;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-radius: 15px;
            margin-bottom: 30px;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        /* Progress Card */
        .progress-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .progress-card h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .progress-bar {
            background: #e2e8f0;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        /* Category Grid */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .category-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            border: 3px solid transparent;
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .category-card.active {
            border-color: #667eea;
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .category-tag {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .file-count {
            background: #48bb78;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.85rem;
        }

        .category-card h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .mini-progress {
            background: #e2e8f0;
            height: 8px;
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }

        .mini-progress-fill {
            background: linear-gradient(90deg, #48bb78 0%, #38a169 100%);
            height: 100%;
            transition: width 0.3s ease;
        }

        /* Form Card */
        .form-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .form-card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }

        .form-group input[type="text"],
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .file-upload-area {
            border: 3px dashed #cbd5e0;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            background: #f7fafc;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .file-upload-area:hover {
            border-color: #667eea;
            background: #edf2f7;
        }

        .file-upload-area.dragover {
            border-color: #48bb78;
            background: #f0fff4;
        }

        .file-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .file-preview-item {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .file-preview-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .file-preview-item .file-name {
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px;
            font-size: 0.8rem;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .remove-file {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #f56565;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remove-file:hover {
            background: #c53030;
        }

        /* Checklist */
        .checklist {
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .checklist-item {
            display: flex;
            align-items: flex-start;
            padding: 12px;
            margin-bottom: 10px;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .checklist-item:hover {
            background: #edf2f7;
        }

        .checklist-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 15px;
            cursor: pointer;
            accent-color: #667eea;
        }

        .checklist-item.checked {
            opacity: 0.6;
        }

        .checklist-item.checked label {
            text-decoration: line-through;
        }

        .checklist-item label {
            cursor: pointer;
            flex: 1;
        }

        /* Buttons */
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(72, 187, 120, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        /* Guide Panel */
        .guide-panel {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            display: none;
        }

        .guide-panel.active {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .guide-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .guide-item {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            padding: 20px;
            border-radius: 12px;
            border-left: 5px solid #667eea;
        }

        .guide-item h3 {
            color: #667eea;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .guide-number {
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .guide-item ul {
            list-style: none;
            padding-left: 0;
        }

        .guide-item li {
            padding: 8px 0;
            color: #4a5568;
            display: flex;
            align-items: flex-start;
        }

        .guide-item li:before {
            content: "•";
            color: #667eea;
            font-weight: bold;
            margin-right: 10px;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 30px;
            background: white;
            border-radius: 15px;
            margin-top: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        footer p {
            color: #718096;
            margin: 5px 0;
        }

        /* Responsive */
        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8rem;
            }

            .category-grid {
                grid-template-columns: 1fr;
            }

            .guide-grid {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }

        /* Status Badge */
        .status-badge {
            display: inline-block;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-top: 15px;
        }

        .status-submitted {
            background: #48bb78;
            color: white;
        }

        /* Alert */
        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
        }

        .alert.success {
            background: #c6f6d5;
            color: #22543d;
            border-left: 5px solid #48bb78;
        }

        .alert.warning {
            background: #feebc8;
            color: #7c2d12;
            border-left: 5px solid #ed8936;
        }

        .alert.active {
            display: block;
            animation: slideDown 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <h1>Yudi & Yoga</h1>
            <p>Platform Audit Sistem Informasi Profesional</p>
            <div id="submittedBadge" style="display:none;">
                <span class="status-badge status-submitted">✓ Submitted pada <span id="submitDate"></span></span>
            </div>
        </header>

        <!-- Progress Card -->
        <div class="progress-card">
            <h2>Kelengkapan Audit Keseluruhan</h2>
            <p style="color: #718096; margin-bottom: 10px;">Progres audit sistem informasi secara keseluruhan</p>
            <div class="progress-bar">
                <div class="progress-fill" id="overallProgress" style="width: 0%;">0%</div>
            </div>
            <p style="margin-top: 10px; color: #718096; font-size: 0.9rem;">Minimal 80% untuk submit laporan</p>
            
            <div class="button-group">
                <button class="btn btn-primary" onclick="toggleGuide()">
                    <span id="guideButtonText">Buka Panduan Audit</span>
                </button>
                <button class="btn btn-success" id="submitBtn" onclick="submitAudit()" disabled>
                    Submit Audit
                </button>
                <button class="btn btn-warning" id="downloadBtn" onclick="downloadReport()" style="display:none;">
                    Download Laporan
                </button>
            </div>

            <div class="alert" id="alertBox"></div>
        </div>

        <!-- Guide Panel -->
        <div class="guide-panel" id="guidePanel">
            <h2 style="color: #667eea; margin-bottom: 15px;">Panduan Audit Sistem Informasi</h2>
            <p style="color: #718096; margin-bottom: 25px;">Standar dan best practices untuk audit yang efektif</p>
            
            <div class="guide-grid">
                <div class="guide-item">
                    <h3><span class="guide-number">1</span> Persiapan Audit</h3>
                    <ul>
                        <li>Pahami scope dan tujuan audit</li>
                        <li>Kumpulkan dokumentasi sistem yang relevan</li>
                        <li>Identifikasi stakeholder dan narasumber</li>
                        <li>Siapkan checklist dan tools audit</li>
                    </ul>
                </div>

                <div class="guide-item">
                    <h3><span class="guide-number">2</span> Eksekusi Audit</h3>
                    <ul>
                        <li>Lakukan wawancara dengan stakeholder</li>
                        <li>Observasi langsung sistem operasional</li>
                        <li>Review dokumentasi dan policies</li>
                        <li>Kumpulkan bukti dan screenshot</li>
                    </ul>
                </div>

                <div class="guide-item">
                    <h3><span class="guide-number">3</span> Dokumentasi Temuan</h3>
                    <ul>
                        <li>Catat semua temuan secara detail</li>
                        <li>Klasifikasikan risiko (High/Medium/Low)</li>
                        <li>Upload bukti foto dan dokumen pendukung</li>
                        <li>Berikan rekomendasi perbaikan</li>
                    </ul>
                </div>

                <div class="guide-item">
                    <h3><span class="guide-number">4</span> Pelaporan</h3>
                    <ul>
                        <li>Lengkapi semua checklist items</li>
                        <li>Verifikasi kelengkapan data minimal 80%</li>
                        <li>Submit audit untuk generate laporan</li>
                        <li>Download dan review laporan</li>
                    </ul>
                </div>
            </div>

            <div style="background: #feebc8; border: 2px solid #ed8936; border-radius: 10px; padding: 20px; margin-top: 25px;">
                <h4 style="color: #7c2d12; margin-bottom: 10px;">Catatan Penting:</h4>
                <p style="color: #7c2d12; font-size: 0.95rem;">
                    Pastikan semua bukti yang diupload jelas dan relevan. Gunakan screenshot dengan resolusi tinggi. 
                    Dokumentasikan setiap temuan dengan detail untuk memudahkan follow-up dan implementasi rekomendasi.
                </p>
            </div>
        </div>

        <!-- Categories Grid -->
        <div class="progress-card">
            <h2>Kategori Audit</h2>
            <p style="color: #718096; margin-bottom: 20px;">Klik kategori untuk mengisi detail audit</p>
            <div class="category-grid" id="categoryGrid"></div>
        </div>

        <!-- Form Card -->
        <div class="form-card">
            <h2>Form Audit Detail</h2>
            <p style="color: #718096; margin-bottom: 25px;">Lengkapi checklist, upload bukti, dan dokumentasikan temuan</p>

            <div class="form-group">
                <label for="categorySelect">Kategori Audit</label>
                <select id="categorySelect" onchange="changeCategory()">
                    <option value="1">Audit Keamanan Sistem</option>
                    <option value="2">Audit Kepatuhan Regulasi</option>
                    <option value="3">Audit Performa Sistem</option>
                    <option value="4">Audit Dokumentasi IT</option>
                </select>
            </div>

            <div class="form-group">
                <label for="tagInput">Tag/Label Kategori</label>
                <input type="text" id="tagInput" placeholder="Masukkan tag (e.g., Keamanan)" onchange="updateTag()">
            </div>

            <!-- Checklist -->
            <div class="form-group">
                <label>Checklist Audit</label>
                <p style="color: #718096; font-size: 0.9rem; margin-bottom: 10px;">Centang item yang sudah selesai diperiksa</p>
                <div class="checklist" id="checklistContainer"></div>
            </div>

            <!-- Findings -->
            <div class="form-group">
                <label for="findings">Temuan Audit</label>
                <p style="color: #718096; font-size: 0.9rem; margin-bottom: 8px;">Dokumentasikan temuan, gap, atau isu yang ditemukan</p>
                <textarea id="findings" placeholder="Contoh: Ditemukan 3 user dengan privilege administrator yang tidak aktif selama 6 bulan..." onchange="updateFindings()"></textarea>
            </div>

            <!-- Notes -->
            <div class="form-group">
                <label for="notes">Catatan & Rekomendasi</label>
                <p style="color: #718096; font-size: 0.9rem; margin-bottom: 8px;">Tambahkan catatan tambahan atau rekomendasi perbaikan</p>
                <textarea id="notes" placeholder="Contoh: Direkomendasikan untuk melakukan review dan disable user inactive..." onchange="updateNotes()"></textarea>
            </div>

            <!-- File Upload -->
            <div class="form-group">
                <label>Upload Bukti Audit</label>
                <p style="color: #718096; font-size: 0.9rem; margin-bottom: 10px;">Upload screenshot, foto, atau dokumen pendukung (multiple files)</p>
                <div class="file-upload-area" id="dropZone" onclick="document.getElementById('fileInput').click()">
                    <div style="font-size: 3rem; margin-bottom: 15px;">📁</div>
                    <p style="font-weight: 600; margin-bottom: 8px;">Klik atau Drag & Drop File</p>
                    <p style="color: #718096; font-size: 0.9rem;">Format: JPG, PNG, PDF, DOC, DOCX</p>
                </div>
                <input type="file" id="fileInput" multiple accept="image/*,.pdf,.doc,.docx" style="display: none;" onchange="handleFiles(this.files)">
                <div class="file-preview" id="filePreview"></div>
            </div>
        </div>

        <!-- Footer -->
        <footer>
            <p style="font-weight: 600; color: #2d3748;">© 2024 Yudi & Yoga - Audit Sistem Informasi Profesional</p>
            <p style="font-size: 0.9rem;">Semua hak dilindungi undang-undang</p>
        </footer>
    </div>

    <script>
        // Data Structure
        let auditData = {
            categories: [
                {
                    id: '1',
                    name: 'Audit Keamanan Sistem',
                    tag: 'Keamanan',
                    files: [],
                    findings: '',
                    notes: '',
                    checklist: [
                        { id: '1-1', text: 'Verifikasi kebijakan password dan autentikasi', checked: false },
                        { id: '1-2', text: 'Periksa konfigurasi firewall dan akses jaringan', checked: false },
                        { id: '1-3', text: 'Evaluasi enkripsi data dan komunikasi', checked: false },
                        { id: '1-4', text: 'Audit log aktivitas dan monitoring keamanan', checked: false },
                        { id: '1-5', text: 'Review manajemen akses pengguna dan privilege', checked: false }
                    ]
                },
                {
                    id: '2',
                    name: 'Audit Kepatuhan Regulasi',
                    tag: 'Kepatuhan',
                    files: [],
                    findings: '',
                    notes: '',
                    checklist: [
                        { id: '2-1', text: 'Verifikasi kepatuhan terhadap ISO 27001', checked: false },
                        { id: '2-2', text: 'Periksa dokumentasi kebijakan IT', checked: false },
                        { id: '2-3', text: 'Evaluasi prosedur backup dan disaster recovery', checked: false },
                        { id: '2-4', text: 'Audit kepatuhan GDPR/regulasi data', checked: false },
                        { id: '2-5', text: 'Review SLA dan kontrak vendor', checked: false }
                    ]
                },
                {
                    id: '3',
                    name: 'Audit Performa Sistem',
                    tag: 'Performa',
                    files: [],
                    findings: '',
                    notes: '',
                    checklist: [
                        { id: '3-1', text: 'Monitor waktu respons aplikasi', checked: false },
                        { id: '3-2', text: 'Analisis penggunaan resource server', checked: false },
                        { id: '3-3', text: 'Evaluasi kapasitas database dan storage', checked: false },
                        { id: '3-4', text: 'Periksa optimasi query dan indexing', checked: false },
                        { id: '3-5', text: 'Review bottleneck dan performance issues', checked: false }
                    ]
                },
                {
                    id: '4',
                    name: 'Audit Dokumentasi IT',
                    tag: 'Dokumentasi',
                    files: [],
                    findings: '',
                    notes: '',
                    checklist: [
                        { id: '4-1', text: 'Verifikasi kelengkapan dokumen arsitektur sistem', checked: false },
                        { id: '4-2', text: 'Periksa dokumentasi prosedur operasional', checked: false },
                        { id: '4-3', text: 'Evaluasi dokumentasi user manual', checked: false },
                        { id: '4-4', text: 'Audit change management records', checked: false },
                        { id: '4-5', text: 'Review dokumentasi incident response', checked: false }
                    ]
                }
            ],
            currentCategory: '1',
            isSubmitted: false,
            submittedDate: ''
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            renderCategories();
            loadCategory('1');
            updateOverallProgress();
            setupDragAndDrop();
        });

        // Render Categories
        function renderCategories() {
            const grid = document.getElementById('categoryGrid');
            grid.innerHTML = '';
            
            auditData.categories.forEach(cat => {
                const completeness = calculateCompleteness(cat);
                const card = document.createElement('div');
                card.className = `category-card ${cat.id === auditData.currentCategory ? 'active' : ''}`;
                card.onclick = () => selectCategory(cat.id);
                
                card.innerHTML = `
                    <div class="category-header">
                        <span class="category-tag">${cat.tag}</span>
                        <span class="file-count">${cat.files.length} file</span>
                    </div>
                    <h3>${cat.name}</h3>
                    <div class="mini-progress">
                        <div class="mini-progress-fill" style="width: ${completeness}%"></div>
                    </div>
                    <p style="font-weight: 600; color: #667eea; margin-top: 8px;">${completeness}% Lengkap</p>
                    <div style="margin-top: 12px; font-size: 0.85rem; color: #718096;">
                        <p>✓ Checklist: ${cat.checklist.filter(i => i.checked).length}/${cat.checklist.length}</p>
                        <p>✓ Temuan: ${cat.findings.length > 0 ? 'Ada' : 'Belum'}</p>
                        <p>✓ Bukti: ${cat.files.length} file</p>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        // Select Category
        function selectCategory(id) {
            auditData.currentCategory = id;
            document.getElementById('categorySelect').value = id;
            loadCategory(id);
            renderCategories();
        }

        // Change Category from Select
        function changeCategory() {
            const id = document.getElementById('categorySelect').value;
            selectCategory(id);
        }

        // Load Category Data
        function loadCategory(id) {
            const cat = auditData.categories.find(c => c.id === id);
            if (!cat) return;
            
            document.getElementById('tagInput').value = cat.tag;
            document.getElementById('findings').value = cat.findings;
            document.getElementById('notes').value = cat.notes;
            
            renderChecklist(cat.checklist);
            renderFilePreview(cat.files);
        }

        // Render Checklist
        function renderChecklist(checklist) {
            const container = document.getElementById('checklistContainer');
            container.innerHTML = '';
            
            checklist.forEach(item => {
                const div = document.createElement('div');
                div.className = `checklist-item ${item.checked ? 'checked' : ''}`;
                div.innerHTML = `
                    <input type="checkbox" id="check-${item.id}" ${item.checked ? 'checked' : ''} 
                           onchange="toggleChecklist('${item.id}')">
                    <label for="check-${item.id}">${item.text}</label>
                `;
                container.appendChild(div);
            });
        }

        // Toggle Checklist
        function toggleChecklist(itemId) {
            const cat = auditData.categories.find(c => c.id === auditData.currentCategory);
            const item = cat.checklist.find(i => i.id === itemId);
            item.checked = !item.checked;
            
            renderChecklist(cat.checklist);
            updateOverallProgress();
        }

        // Update Tag
        function updateTag() {
            const cat = auditData.categories.find(c => c.id === auditData.currentCategory);
            cat.tag = document.getElementById('tagInput').value;
            renderCategories();
        }

        // Update Findings
        function updateFindings() {
            const cat = auditData.categories.find(c => c.id === auditData.currentCategory);
            cat.findings = document.getElementById('findings').value;
            updateOverallProgress();
        }

        // Update Notes
        function updateNotes() {
            const cat = auditData.categories.find(c => c.id === auditData.currentCategory);
            cat.notes = document.getElementById('notes').value;
            updateOverallProgress();
        }

        // Setup Drag and Drop
        function setupDragAndDrop() {
            const dropZone = document.getElementById('dropZone');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, () => dropZone.classList.add('dragover'), false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, () => dropZone.classList.remove('dragover'), false);
            });
            
            dropZone.addEventListener('drop', function(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleFiles(files);
            }, false);
        }

        // Handle Files
        function handleFiles(files) {
            const cat = auditData.categories.find(c => c.id === auditData.currentCategory);
            
            Array.from(files).forEach(file => {
                if (file.size > 10 * 1024 * 1024) { // 10MB limit per file
                    showAlert('File ' + file.name + ' terlalu besar. Maksimal 10MB per file.', 'warning');
                    return;
                }
                
                cat.files.push({
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    data: file
                });
            });
            
            renderFilePreview(cat.files);
            updateOverallProgress();
        }

        // Render File Preview
        function renderFilePreview(files) {
            const preview = document.getElementById('filePreview');
            preview.innerHTML = '';
            
            files.forEach((file, index) => {
                const div = document.createElement('div');
                div.className = 'file-preview-item';
                
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        div.innerHTML = `
                            <img src="${e.target.result}" alt="Preview audit evidence">
                            <div class="file-name">${file.name}</div>
                            <button class="remove-file" onclick="removeFile(${index})">×</button>
                        `;
                    };
                    reader.readAsDataURL(file.data);
                } else {
                    div.innerHTML = `
                        <div style="width: 100%; height: 150px; background: #edf2f7; display: flex; align-items: center; justify-content: center; font-size: 3rem;">
                            📄
                        </div>
                        <div class="file-name">${file.name}</div>
                        <button class="remove-file" onclick="removeFile(${index})">×</button>
                    `;
                }
                
                preview.appendChild(div);
            });
        }

        // Remove File
        function removeFile(index) {
            const cat = auditData.categories.find(c => c.id === auditData.currentCategory);
            cat.files.splice(index, 1);
            renderFilePreview(cat.files);
            updateOverallProgress();
        }

        // Calculate Completeness
        function calculateCompleteness(cat) {
            const checklistScore = (cat.checklist.filter(i => i.checked).length / cat.checklist.length) * 40;
            const filesScore = Math.min((cat.files.length / 3) * 30, 30);
            const findingsScore = cat.findings.trim().length > 20 ? 20 : 0;
            const notesScore = cat.notes.trim().length > 10 ? 10 : 0;
            return Math.round(checklistScore + filesScore + findingsScore + notesScore);
        }

        // Update Overall Progress
        function updateOverallProgress() {
            const total = auditData.categories.reduce((sum, cat) => sum + calculateCompleteness(cat), 0);
            const overall = Math.round(total / auditData.categories.length);
            
            document.getElementById('overallProgress').style.width = overall + '%';
            document.getElementById('overallProgress').textContent = overall + '%';
            
            document.getElementById('submitBtn').disabled = overall < 80;
            
            renderCategories();
        }

        // Toggle Guide
        function toggleGuide() {
            const panel = document.getElementById('guidePanel');
            const button = document.getElementById('guideButtonText');
            
            if (panel.classList.contains('active')) {
                panel.classList.remove('active');
                button.textContent = 'Buka Panduan Audit';
            } else {
                panel.classList.add('active');
                button.textContent = 'Tutup Panduan';
            }
        }

        // Show Alert
        function showAlert(message, type) {
            const alert = document.getElementById('alertBox');
            alert.textContent = message;
            alert.className = `alert ${type} active`;
            
            setTimeout(() => {
                alert.classList.remove('active');
            }, 5000);
        }

        // Submit Audit
        function submitAudit() {
            const now = new Date();
            auditData.isSubmitted = true;
            auditData.submittedDate = now.toLocaleString('id-ID', {
                day: '2-digit',
                month: 'long',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            document.getElementById('submittedBadge').style.display = 'block';
            document.getElementById('submitDate').textContent = auditData.submittedDate;
            document.getElementById('submitBtn').style.display = 'none';
            document.getElementById('downloadBtn').style.display = 'inline-block';
            
            showAlert('Audit berhasil disubmit! Anda dapat mendownload laporan.', 'success');
        }

        // Download Report
        function downloadReport() {
            let report = '='.repeat(80) + '\n';
            report += 'LAPORAN AUDIT SISTEM INFORMASI\n';
            report += 'Yudi & Yoga - Platform Audit SI Profesional\n';
            report += '='.repeat(80) + '\n\n';
            report += 'Tanggal Submit: ' + auditData.submittedDate + '\n';
            report += 'Kelengkapan Keseluruhan: ' + document.getElementById('overallProgress').textContent + '\n';
            report += '='.repeat(80) + '\n\n';
            
            auditData.categories.forEach((cat, idx) => {
                report += `\n${idx + 1}. ${cat.name.toUpperCase()}\n`;
                report += '-'.repeat(80) + '\n';
                report += `Tag: ${cat.tag}\n`;
                report += `Kelengkapan: ${calculateCompleteness(cat)}%\n\n`;
                
                report += 'CHECKLIST:\n';
                cat.checklist.forEach((item, i) => {
                    report += `   ${i + 1}. [${item.checked ? '✓' : ' '}] ${item.text}\n`;
                });
                
                report += '\nTEMUAN:\n';
                report += cat.findings || '(Tidak ada temuan)\n';
                
                report += '\nCATATAN & REKOMENDASI:\n';
                report += cat.notes || '(Tidak ada catatan)\n';
                
                report += `\nBUKTI UPLOAD: ${cat.files.length} file(s)\n`;
                cat.files.forEach((file, i) => {
                    report += `   ${i + 1}. ${file.name} (${(file.size / 1024).toFixed(2)} KB)\n`;
                });
                
                report += '\n' + '='.repeat(80) + '\n';
            });
            
            report += '\n\n--- END OF REPORT ---\n';
            report += '© 2024 Yudi & Yoga. Semua hak dilindungi.\n';
            
            const blob = new Blob([report], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `Laporan_Audit_SI_YudiYoga_${Date.now()}.txt`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showAlert('Laporan berhasil didownload!', 'success');
        }
    </script>
</body>
</html>
